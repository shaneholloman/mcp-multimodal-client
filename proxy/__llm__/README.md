# MCP Proxy Server

A high-performance proxy server that bridges web applications with Model Context Protocol (MCP) servers. It supports both local stdio-based servers and remote SSE-based servers, with automatic configuration management and real-time communication.

## Features

- **Dual Transport Support**:

  - `stdio`: For local MCP servers running as child processes
  - `sse`: For remote MCP servers communicating via Server-Sent Events

- **Intelligent Server Management**:

  - Automatic server discovery and configuration
  - Dynamic environment variable handling
  - Graceful startup/shutdown
  - Robust error handling and logging

- **Configuration Management**:
  - Automatic core server configuration
  - Custom server support
  - Environment variable inheritance
  - Configuration persistence

## API Endpoints

### GET /v1/mcp

Returns available MCP servers and their configurations.

Response:

```json
{
  "mcpServers": {
    "serverId": {
      "command": "string",
      "args": ["string"],
      "env": ["ENV_VAR"],
      "metadata": {
        "icon": "string",
        "color": "string",
        "description": "string",
        "serverType": "core" | "custom"
      }
    }
  },
  "customServers": {},
  "defaults": {
    "serverTypes": {
      "stdio": {},
      "sse": {}
    },
    "unconnected": {}
  }
}
```

### GET /v1/user/mcp

Returns user configuration and API key information.

### GET /sse

Establishes a Server-Sent Events connection to an MCP server.

Query Parameters:

- `serverId`: The ID of the server to connect to
- `transportType`: Either "stdio" or "sse"

### POST /message

Sends a message to a connected MCP server.

Query Parameters:

- `sessionId`: The session ID of the connection

## Configuration

The server uses `mcp.config.json` for server configuration:

```json
{
  "_warning": "This file is automatically generated. DO NOT EDIT DIRECTLY.",
  "mcpServers": {
    "serverId": {
      "command": "string",
      "args": ["-y", "package-name"],
      "env": ["ENV_VAR"],
      "metadata": {
        "icon": "string",
        "color": "string",
        "description": "string",
        "serverType": "core" | "custom"
      }
    }
  },
  "customServers": {}
}
```

### Core Servers

Core servers are automatically configured with:

- Correct package name in args (`["-y", "server-id"]`)
- Proper environment variables
- Metadata including icon, color, and description

### Custom Servers

Custom servers can be added with:

- Custom command and arguments
- Environment variable requirements
- Custom metadata

## Development

1. Install dependencies:

```bash
npm install
```

2. Start the development server:

```bash
npm run dev
```

3. Run tests:

```bash
npm test
```

## Best Practices

1. **Configuration Management**:

   - Never edit `mcp.config.json` directly
   - Use the API endpoints to update configuration
   - Core server args are automatically managed

2. **Error Handling**:

   - All errors are properly logged
   - Client receives meaningful error messages
   - Graceful degradation on failures

3. **Transport Management**:
   - Proper cleanup of resources
   - Automatic reconnection handling
   - Bidirectional error propagation
